' version 0.8.66

Private Function SplitJsonIntoChunks(jsonString As String, chunkSize As Long) As String()
    On Error GoTo ErrorHandler
    
    Dim jsonArray As Object
    Dim chunks() As String
    Dim chunkCount As Long
    Dim i As Long, j As Long
    
    ' Attempt to parse the JSON string
    Set jsonArray = JsonConverter.ParseJson(jsonString)
    
    ' If we get here, parsing was successful
    chunkCount = (jsonArray.count + chunkSize - 1) \ chunkSize
    ReDim chunks(1 To chunkCount)
    
    For i = 1 To chunkCount
        Dim chunkArray As New Collection
        For j = (i - 1) * chunkSize + 1 To Min(i * chunkSize, jsonArray.count)
            chunkArray.Add jsonArray(j)
        Next j
        chunks(i) = "[" & JsonConverter.ConvertToJSON(chunkArray) & "]"  ' Ensure it's a JSON array
    Next i
    
    SplitJsonIntoChunks = chunks
    Exit Function

ErrorHandler:
    ' Handle the error gracefully
    Dim errorMsg As String
    errorMsg = "Error in SplitJsonIntoChunks: " & Err.Description
    
    ' Log the error (you can modify this to use your preferred logging method)
    Debug.Print errorMsg
    
    ' Return an empty array to indicate failure
    ReDim chunks(0 To 0)
    SplitJsonIntoChunks = chunks
End Function

