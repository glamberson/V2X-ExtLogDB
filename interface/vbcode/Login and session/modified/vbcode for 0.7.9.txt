' Function to authenticate user and get session token
Public Function AuthenticateUser(username As String, password As String, duration As String) As String
    Dim cmd As Object
    Dim rs As Object
    Dim token As String

    Set cmd = CreateObject("ADODB.Command")
    cmd.ActiveConnection = g_conn
    cmd.CommandText = "SELECT login_wrapper(?, ?, ?)"
    cmd.Parameters.Append cmd.CreateParameter("@username", adVarChar, adParamInput, 255, username)
    cmd.Parameters.Append cmd.CreateParameter("@password", adVarChar, adParamInput, 255, password)
    cmd.Parameters.Append cmd.CreateParameter("@duration", adVarChar, adParamInput, 255, duration)
    
    Set rs = cmd.Execute
    If Not rs.EOF Then
        token = rs.Fields(0).Value
    End If
    rs.Close
    Set rs = Nothing
    Set cmd = Nothing

    AuthenticateUser = token
End Function

' Example login procedure
Private Sub btnLogin_Click()
    Dim username As String
    Dim password As String
    Dim duration As String
    Dim token As String

    username = Me.txtUsername.Value
    password = Me.txtPassword.Value
    duration = "1 hour" ' Or any other duration as needed

    ' Authenticate user and get session token
    On Error GoTo LoginFailed
    token = AuthenticateUser(username, password, duration)
    
    ' Store the token for future use
    Me.txtSessionToken.Value = token
    MsgBox "Login Successful", vbInformation
    ' Proceed with the application logic
    Exit Sub

LoginFailed:
    MsgBox "Invalid username or password", vbCritical
End Sub



